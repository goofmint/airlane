#!/usr/bin/env node
let inquirer = require("inquirer");
var fs = require('fs-extra');
require('../libs/common');

let target_dir = fs.realpathSync('./');
let model_name = process.argv[2];
var templates = require('./templates')(model_name);

// Check directory
var mailer_dir = `${target_dir}/modules/mailer/`;
var path = `${mailer_dir}${model_name}.js`

var questions = [];
var promises = [];

promises.push(new Promise((res, rej) => {
  fs.access(path, 'wx', (err, fd) => {
    if (err == null) {
      return res({
        type: 'confirm',
        name: 'overwrite',
        message: `File ${model_name} exist. Could you overwrite it?`,
        default: true
      });
    }
    return res(null)
  });
}));

Promise.all(promises).then((values) => {
  questions = values.filter(function(question) {
    return question != null;
  });
  
  if (questions.length === 0) {
    return createBase();
  }
  inquirer.prompt(questions).then((answers) => {
    if (!answers.overwrite) {
      process.exit(1);
    }
    createBase(answers);
  });
});


createBase = (answers = {}) => {
  if (answers[`overwrite`] !== false) {
    fs.mkdirsSync(mailer_dir);
    fs.writeFileSync(`${path}`, templates['mailer']);
    console.log(`${path} created.`)
  }
}
